<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Confounding | YanhaoBlog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Confounding Factors (Confounding) and Causal Inference1 Concept and Impact of Confounding FactorsConfounding factors are variables that influence both the treatment and the outcome, causing a spurious">
<meta property="og:type" content="article">
<meta property="og:title" content="Confounding">
<meta property="og:url" content="http://bran-d.github.io/2023/12/28/Confounding/index.html">
<meta property="og:site_name" content="YanhaoBlog">
<meta property="og:description" content="Confounding Factors (Confounding) and Causal Inference1 Concept and Impact of Confounding FactorsConfounding factors are variables that influence both the treatment and the outcome, causing a spurious">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-12-28T08:32:07.000Z">
<meta property="article:author" content="Yanhao Wu">
<meta property="article:tag" content="Causal Inference">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="../../../../atom.xml" title="YanhaoBlog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="../../../../favicon.png">
  
  
  
<link rel="stylesheet" href="../../../../css/style.css">

  
    
<link rel="stylesheet" href="../../../../fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="../../../../index.html" id="logo">YanhaoBlog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="../../../../index.html">Home</a>
        
          <a class="main-nav-link" href="../../../../archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="../../../../atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://bran-d.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Confounding" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="" class="article-date">
  <time class="dt-published" datetime="2023-12-28T08:32:07.000Z" itemprop="datePublished">2023-12-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Confounding
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Confounding-Factors-Confounding-and-Causal-Inference"><a href="#Confounding-Factors-Confounding-and-Causal-Inference" class="headerlink" title="Confounding Factors (Confounding) and Causal Inference"></a>Confounding Factors (Confounding) and Causal Inference</h1><h2 id="1-Concept-and-Impact-of-Confounding-Factors"><a href="#1-Concept-and-Impact-of-Confounding-Factors" class="headerlink" title="1 Concept and Impact of Confounding Factors"></a>1 Concept and Impact of Confounding Factors</h2><p><strong>Confounding factors</strong> are variables that influence both the treatment and the outcome, causing a spurious association between them. These factors create biases in estimating the causal effect of a treatment or intervention.</p>
<p>For example, in a study examining the effect of exercise on heart health, age could be a confounder if older individuals are less likely to exercise but also more likely to have heart problems.</p>
<hr>
<h2 id="2-The-Importance-of-Identifying-and-Adjusting-for-Confounding-Factors"><a href="#2-The-Importance-of-Identifying-and-Adjusting-for-Confounding-Factors" class="headerlink" title="2 The Importance of Identifying and Adjusting for Confounding Factors"></a>2 The Importance of Identifying and Adjusting for Confounding Factors</h2><p>Confounding leads to biased estimates of treatment effects, as it distorts the true relationship between treatment and outcome. Therefore, it is crucial to identify and adjust for confounding factors in order to isolate the causal effect of the treatment.</p>
<hr>
<h2 id="3-Adjusting-for-Confounders-Using-Propensity-Score"><a href="#3-Adjusting-for-Confounders-Using-Propensity-Score" class="headerlink" title="3 Adjusting for Confounders Using Propensity Score"></a>3 Adjusting for Confounders Using <strong>Propensity Score</strong></h2><p>A widely-used method for addressing confounding is the <strong>propensity score</strong>. The propensity score is the probability of receiving the treatment given a set of observed covariates. It helps balance the distribution of confounders between treated and untreated groups, allowing for more accurate causal inferences.</p>
<hr>
<h3 id="3-1-Propensity-Score-Matching-PSM"><a href="#3-1-Propensity-Score-Matching-PSM" class="headerlink" title="3.1 Propensity Score Matching (PSM)"></a>3.1 Propensity Score Matching (PSM)</h3><p><strong>Propensity Score Matching (PSM)</strong> is a technique where individuals from the treatment group are matched with individuals from the control group based on similar propensity scores. This helps create a balanced dataset where the treatment and control groups are comparable in terms of the observed confounders.</p>
<hr>
<h3 id="3-2-Inverse-Probability-Weighting-IPW"><a href="#3-2-Inverse-Probability-Weighting-IPW" class="headerlink" title="3.2 Inverse Probability Weighting (IPW)"></a>3.2 Inverse Probability Weighting (IPW)</h3><p><strong>Inverse Probability Weighting (IPW)</strong> is another method that uses the propensity score to adjust for confounding. Each individual is weighted by the inverse of the probability of receiving the treatment they actually received. This approach creates a “pseudo-population” where the confounders are balanced across treatment groups.</p>
<hr>
<h2 id="4-Estimating-and-Implementing-Propensity-Scores-in-R"><a href="#4-Estimating-and-Implementing-Propensity-Scores-in-R" class="headerlink" title="4 Estimating and Implementing Propensity Scores in R"></a>4 Estimating and Implementing Propensity Scores in R</h2><h3 id="R-Code-Example-Estimating-Propensity-Scores-and-Using-PSM"><a href="#R-Code-Example-Estimating-Propensity-Scores-and-Using-PSM" class="headerlink" title="R Code Example: Estimating Propensity Scores and Using PSM"></a>R Code Example: Estimating Propensity Scores and Using PSM</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Load necessary libraries</span></span><br><span class="line">library<span class="punctuation">(</span>MASS<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>MatchIt<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Simulate data</span></span><br><span class="line">set.seed<span class="punctuation">(</span><span class="number">123</span><span class="punctuation">)</span></span><br><span class="line">n <span class="operator">&lt;-</span> 500</span><br><span class="line"><span class="comment"># Covariate that is a confounder</span></span><br><span class="line">age <span class="operator">&lt;-</span> rnorm<span class="punctuation">(</span>n<span class="punctuation">,</span> mean <span class="operator">=</span> <span class="number">50</span><span class="punctuation">,</span> sd <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># Treatment assignment based on the confounder</span></span><br><span class="line">W <span class="operator">&lt;-</span> rbinom<span class="punctuation">(</span>n<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> prob <span class="operator">=</span> plogis<span class="punctuation">(</span><span class="number">0.05</span> <span class="operator">*</span> age <span class="operator">-</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># Outcome influenced by both treatment and confounder</span></span><br><span class="line">Y <span class="operator">&lt;-</span> 5 <span class="operator">+</span> <span class="number">0.5</span> <span class="operator">*</span> W <span class="operator">+</span> <span class="number">0.2</span> <span class="operator">*</span> age <span class="operator">+</span> rnorm<span class="punctuation">(</span>n<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a dataframe</span></span><br><span class="line">data <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>W<span class="punctuation">,</span> Y<span class="punctuation">,</span> age<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Estimate propensity scores using logistic regression</span></span><br><span class="line">ps_model <span class="operator">&lt;-</span> glm<span class="punctuation">(</span>W <span class="operator">~</span> age<span class="punctuation">,</span> family <span class="operator">=</span> binomial<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> data <span class="operator">=</span> data<span class="punctuation">)</span></span><br><span class="line">propensity_scores <span class="operator">&lt;-</span> predict<span class="punctuation">(</span>ps_model<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;response&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 1: Perform Propensity Score Matching (PSM)</span></span><br><span class="line">match_it <span class="operator">&lt;-</span> matchit<span class="punctuation">(</span>W <span class="operator">~</span> age<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&quot;nearest&quot;</span><span class="punctuation">,</span> data <span class="operator">=</span> data<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check balance after matching</span></span><br><span class="line">summary<span class="punctuation">(</span>match_it<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 2: Estimate treatment effect using matched data</span></span><br><span class="line">matched_data <span class="operator">&lt;-</span> match.data<span class="punctuation">(</span>match_it<span class="punctuation">)</span></span><br><span class="line">treatment_effect <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>Y <span class="operator">~</span> W<span class="punctuation">,</span> data <span class="operator">=</span> matched_data<span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>treatment_effect<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 3: Perform Inverse Probability Weighting (IPW)</span></span><br><span class="line">weights <span class="operator">&lt;-</span> ifelse<span class="punctuation">(</span>W <span class="operator">==</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span> <span class="operator">/</span> propensity_scores<span class="punctuation">,</span> <span class="number">1</span> <span class="operator">/</span> <span class="punctuation">(</span><span class="number">1</span> <span class="operator">-</span> propensity_scores<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Estimate weighted treatment effect</span></span><br><span class="line">weighted_model <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>Y <span class="operator">~</span> W<span class="punctuation">,</span> weights <span class="operator">=</span> weights<span class="punctuation">,</span> data <span class="operator">=</span> data<span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>weighted_model<span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://bran-d.github.io/2023/12/28/Confounding/" data-id="cm1yrqxfz0000tk36b9s16w6z" data-title="Confounding" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Causal-Inference/" rel="tag">Causal Inference</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../../../../2024/01/07/Instrumental-Variables/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Instrumental Variables
        
      </div>
    </a>
  
  
    <a href="../../14/Counterfactual-Framework/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Counterfactual Framework</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Causal-Inference/" rel="tag">Causal Inference</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/machine-learning/" rel="tag">machine learning</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../../../../tags/Causal-Inference/" style="font-size: 10px;">Causal Inference</a> <a href="../../../../tags/machine-learning/" style="font-size: 20px;">machine learning</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2022/03/">March 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../../../../2024/05/13/2/">2</a>
          </li>
        
          <li>
            <a href="../../../../2024/03/09/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="../../../../2024/01/21/Difference-in-Differences/">Difference-in-Differences</a>
          </li>
        
          <li>
            <a href="../../../../2024/01/14/Regression-Discontinuity-Design/">Regression Discontinuity Design</a>
          </li>
        
          <li>
            <a href="../../../../2024/01/07/Instrumental-Variables/">Instrumental Variables</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Yanhao Wu<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="../../../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../../../archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="../../../../js/jquery-3.6.4.min.js"></script>



  
<script src="../../../../fancybox/jquery.fancybox.min.js"></script>




<script src="../../../../js/script.js"></script>





  </div>
</body>
</html>